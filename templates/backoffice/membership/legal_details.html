<!DOCTYPE html>

<html lang="en">

<!-- BEGIN HEAD -->
{% load staticfiles %}
<head>
    <meta charset="utf-8"/>
    <title>MCCIA | Legal Details </title>
    {% include 'backoffice/base_css.html' %}


</head>
<!-- END HEAD -->


<style type="text/css">

th.dt-center, td.dt-center {
    text-align: center;
}


</style>


<body class="page-header-fixed page-sidebar-closed-hide-logo page-container-bg-solid">
<!-- BEGIN HEADER -->
<div id="processing" style="display:none;">
    <div id="loading">
        <img src="{% static 'assets/loading-bars.gif' %}" style="height : 100px;">

    </div>
</div>
<!-- BEGIN HEADER -->
<div class="page-header navbar navbar-fixed-top">
    <!-- BEGIN HEADER INNER -->
    <div class="page-header-inner ">
        <!-- BEGIN LOGO -->
        <div class="page-logo">
            <a href="index.html">
                <img src="{% static 'assets/MCCIA-logo.png' %}" alt="logo"
                     class="logo-default"/> </a>
            <div class="menu-toggler sidebar-toggler">
                <!-- DOC: Remove the above "hide" to enable the sidebar toggler button on header -->
            </div>
        </div>
        <!-- END LOGO -->
        <!-- BEGIN RESPONSIVE MENU TOGGLER -->
        <a href="javascript:;" class="menu-toggler responsive-toggler" data-toggle="collapse"
           data-target=".navbar-collapse"> </a>
        <!-- END RESPONSIVE MENU TOGGLER -->
        <!-- BEGIN PAGE TOP -->
        <div class="page-top">
            <!-- BEGIN TOP NAVIGATION MENU -->
            <div class="top-menu">
                <ul class="nav navbar-nav pull-right">
                    <li class="dropdown dropdown-user">
                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown" data-hover="dropdown"
                           data-close-others="true">
                            <!-- <img alt="" class="img-circle" src="{% static 'assets/layouts/layout2/img/avatar3_small.jpg" /> -->
                            <span class="username username-hide-on-mobile"> {{ request.session.login_user }} </span>
                            <i class="fa fa-angle-down"></i>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-default">
                            <li>
                                <a href="/edit-profile/?user_id={{request.session.login_user}}">
                                    <i class="fa fa-user" aria-hidden="true"></i> My Profile </a>
                            </li>
                            <li>
                                <a href="/log-out/">
                                    <i class="icon-key"></i> Log Out </a>
                            </li>
                        </ul>
                    </li>
                    <!-- END USER LOGIN DROPDOWN -->
                </ul>
            </div>
            <!-- END TOP NAVIGATION MENU -->
        </div>
        <!-- END PAGE TOP -->
    </div>
    <!-- END HEADER INNER -->
</div>
<!-- END HEADER -->

<!-- BEGIN HEADER & CONTENT DIVIDER -->
<div class="clearfix"></div>
<!-- END HEADER & CONTENT DIVIDER -->


<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN SIDEBAR -->
    <div class="page-sidebar-wrapper">
        <div class="page-sidebar navbar-collapse collapse">
            {% include 'backoffice/membership/side-panel.html' %}
        </div>
    </div>
    <!-- END SIDEBAR -->


    <!-- BEGIN CONTENT -->
    <div class="page-content-wrapper">
        <!-- BEGIN CONTENT BODY -->
        <div class="page-content">


            <div class="row">
                <div class="col-lg-12">
                    <div class="portlet light  ">

                        <div class="page-bar">
                            <ul class="page-breadcrumb">
                                <li>
                                    <a href="/backofficeapp/backoffice/" style="color: #3eb199;font-size: 16px;">Membership</a>
                                        <i class="fa fa-angle-right"></i>
                                </li>
                                <li>
                                    <span style="color: #00448b;font-size: 16px;">Legal Details</span>
                                </li>
                            </ul>
                        </div>


                        <div class="row ">
                            <div class="col-lg-12">
                                <div class="col-lg-3">
                                    <div class="input-group form-group">
                                <span class="input-group-btn">
                                    <span style=" height: 34px;"
                                          class="btn btn btn-default">
                                        <span class="fa fa-search"></span>
                                    </span>
                                </span>
                                        <input style=" font-size: 14px; " type="text"
                                               class="form-control " id="search_legal_detail_text"
                                               placeholder="Search Description" name="search_legal_detail_text">
                                    </div>
                                </div>
                                <div class="col-lg-2"
                                     style="border: none !important;  margin-top: 6px;font-size: 16px;    width: 95px;">
                                    <span>Filter By:  </span>
                                </div>
                                <div class="col-lg-2"
                                     style="border: none !important;  font-size: 16px;">
                                    <select id="select_legal_detail_status" class="form-control select2">
                                        <option style="font-size: 14px" value="show_all">Show All</option>
                                        <option style="font-size: 14px" value="True">Active</option>
                                        <option style="font-size: 14px" value="False">Inactive</option>
                                    </select>
                                </div>

                                <div class="col-lg-2">
                                    <center>
                                        <div style="color: #797979;">
                                            <a style="font-size: 16px; width:  80%;" type="button"
                                               class="btn done_btn" onclick="filter_legal_detail_table()"
                                               href="#">Filter
                                            </a>
                                        </div>
                                    </center>
                                </div>

                                <div class="col-lg-3">
                                    <div class="pull-right " style="color: #797979;">
                                        <a style="font-size: 16px; " type="button"
                                           class="btn done_btn " data-toggle="modal"
                                           href="/backofficeapp/add-legal-details/">Add Legal Details
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <hr class="hre">
                        <div class="portlet-body form">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="portlet-body">
                                        <div class="actions">
                                            <div class="btn-group pull-right">
                                                <a class="btn red btn-outline btn-circle"
                                                   href="javascript:;"
                                                   data-toggle="dropdown">
                                                    <i class="fa fa-share"></i>
                                                    <span class="hidden-xs"> Tools </span>
                                                    <i class="fa fa-angle-down"></i>
                                                </a>
                                                <ul class="dropdown-menu pull-right"
                                                    id="industry_details_table_tools">
                                                    <li>
                                                        <a href="javascript:;" data-action="0"
                                                           class="tool-action">
                                                            <i class="icon-printer"></i> Print</a>
                                                    </li>

                                                    <li>
                                                        <a href="javascript:;" data-action="2"
                                                           class="tool-action">
                                                            <i class="icon-doc"></i> PDF</a>
                                                    </li>
                                                    <li>
                                                        <a href="javascript:;" data-action="3"
                                                           class="tool-action">
                                                            <i class="icon-paper-clip"></i> Excel</a>
                                                    </li>
                                                    <li>
                                                        <a href="javascript:;" data-action="4"
                                                           class="tool-action">
                                                            <i class="icon-cloud-upload"></i> CSV</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                        <table class="table table-striped table-bordered table-hover table-checkable order-column"
                                               id="legal_details">
                                            <thead>
                                            <tr>
                                                <th class="text-center"> Sr. No</th>
                                                <th class="text-center"> Code</th>
                                                <th style="text-align: center;"> Description</th>
                                                <th> Status</th>
                                                <th class="text-center"> Action</th>
                                            </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                                <!-- END FORM-->
                            </div>
                        </div>
                        <!-- END PORTLET-->
                    </div>
                </div>
            </div>
            <!-- END CONTENT BODY -->
        </div>
        <!-- END CONTENT -->
    </div>  <!-- END PORTLET-->
</div>
<!-- END CONTAINER -->


<div class="modal fade draggable-modal" id="edit_legal_details_modal" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog" style="width:50%;">
        <div class="modal-content">
            <div class="modal-header">
                Edit Legal Details
            </div>
            <div class="modal-body">
                <form id="edit_legal_details_form" name="edit_legal_details_form" method="POST">
                    <input type="hidden" id="legal_id" name="legal_id" class="form-control" hidden>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="control-label">Code (Max 3 Digit)
                                <span class="required"> * </span>
                            </label>
                            <input id="edit_legal_code" name="edit_legal_code" class="form-control"/>
                            <label id="edit_legal_code_error" class="error" style="color:red; display:none;"></label>
                        </div>

                        <div class="col-md-8">
                            <label class="control-label">Description (Max 20 Char)
                                <span class="required"> * </span>
                            </label>
                            <input id="edit_legal_desc" name="edit_legal_desc"
                                   class="form-control"/>
                            <label id="edit_legal_desc_error" class="error"
                                   style="color:red; display:none;"></label>
                        </div>

                    </div>


                    <div class="row" style="  margin-top: 30px;">

                    </div>

                </form>
                <div style="text-align:center !important;" class="modal-footer">
                    <div class="col-xs-12 text-right">

                        <button type="button" class="btn btn-outline grey_color "
                                data-dismiss="modal">Cancel
                        </button>
                        <button type="button" id="update_legal_detail" class="btn btn-outline done_btn">Save</button>
                    </div>

                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</div>

<div class="modal fade draggable-modal" id="active_deactive_legal_modal" tabindex="-1" role="basic" aria-hidden="true">
    <div class="modal-dialog" style="width:35%;">
        <div class="modal-content">
            <div class="modal-body">
                <form action="index.html" class="form-horizontal form-row-seperated">
                    <input type="text" id="legal_status" name="legal_status" hidden>
                    <input type="text" id="legal_status_id" name="legal_status_id" hidden>
                    <div class="form-body">
                        <h4 class="text-center" id="active_deactive_legal_status_text">Do you want to re-activate User
                            ?</h4>
                    </div>
                </form>
            </div>
            <div style="text-align:center !important;" class="modal-footer">
                <button type="button" onclick="change_legal_status()" data-dismiss="modal" class="btn green">Yes
                </button>
                <button type="button" class="btn green" data-dismiss="modal">No</button>

            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
</div>

<!-- BEGIN FOOTER -->
<div class="page-footer">
    <div class="page-footer-inner"> 2018 © Bynry Technologies

    </div>
    <div class="scroll-to-top">
        <i class="icon-arrow-up"></i>
    </div>
</div>
</div>
<!-- END FOOTER -->

{% include 'backoffice/base_js.html' %}
<!-- END THEME LAYOUT SCRIPTS -->

<script type="text/javascript">

$("#member_anchor").addClass("tab-active");
$("#member_nav").addClass("active");
$("#member_icon").addClass("icon-active");
$("#member_active").css("display","block");
$("#member_nav").addClass("active");

		
$(".sel2").select2({
            width: '100%'
        })

$(document).ready(function(){
    var legal_detail_status = 'show_all';
    request_legal_detail_table(legal_detail_status)
});

    function request_legal_detail_table(legal_detail_status){
        var table = $('#legal_details');
        var oTable = table.dataTable({
            "processing": true,
            "serverSide": true,
            "destroy": true,
            "ajax": '/backofficeapp/get-legal-details-datatable/?legal_detail_status='+legal_detail_status,
            "searching": true,
            "Filter": true,
            "ordering": false,
            "paging": true,
            "columnDefs": [
                {"className": "dt-center","targets": 0, "orderable": false},
                {"className": "dt-center","targets": 1, "orderable": false},
                {"className": "dt-left", "targets": 2, "orderable": false},
                {"className": "dt-center","targets": 3, "orderable": false},
                {"className": "dt-center","targets": 4, "orderable": false},
            ],
            buttons: [
                {extend: 'print', className: 'btn dark btn-outline',
                    exportOptions: { columns: [0, 1, 2, 3] },
                },
                {extend: 'copy', className: 'btn red btn-outline',
                    exportOptions: { columns: [0, 1, 2, 3] },
                },
                {extend: 'pdf',className: 'btn green btn-outline',
                    exportOptions: { columns: [0, 1, 2, 3] },
                },
                {extend: 'excel',className: 'btn yellow btn-outline',
                    exportOptions: { columns: [0, 1, 2, 3] },
                },
                {extend: 'csv',className: 'btn purple btn-outline',
                    exportOptions: { columns: [0, 1, 2, 3] },
                },
                {extend: 'colvis',className: 'btn dark btn-outline',text: 'Columns'}
            ],

            responsive: false,

            "order": [
                [0, 'asc']
            ],

            "lengthMenu": [ [10, 25, 50, 100, -1], [10, 25, 50, 100, "All"] ],

            "pageLength": 10,
        });

        $(".dataTables_filter").hide();

        $("#search_legal_detail_text").keyup(function() {
            oTable.fnFilter($("#search_legal_detail_text").val());
        });

        $('#legal_details_tools > li > a.tool-action').on('click', function() {
            var action = $(this).attr('data-action');
            $('#legal_details').DataTable().button(action).trigger();
        });
    }

    function filter_legal_detail_table(){
        legal_detail_status = $("#select_legal_detail_status").val();
        request_legal_detail_table(legal_detail_status);
    }




// Show Edit Legal Detail
function show_edit_legal_modal(legal_id) {
    $("#legal_id").val(legal_id);
    $.ajax({
        type: "GET",
        url:  "/backofficeapp/show-edit-legal-detail/",
        data: {'legal_id': legal_id},
        success: function(response){
            if (response.success == 'true'){
                $("#edit_legal_code").val(response.legal_code);
                $("#edit_legal_desc").val(response.legal_desc);
            }
        }
    });
}


// Update Legal Detail
$("#update_legal_detail").click(function(){
    var flag = true;
    legal_code = $("#edit_legal_code").val();
    var legal_code_pattern = /^\d{1,3}$/;

    if (legal_code != '' && legal_code_pattern.test(legal_code)) {
        $('#edit_legal_code_error').css("display", "none");
    }
    else {
        $('#edit_legal_code_error').css("display", "block");
        $('#edit_legal_code_error').text("Please enter valid Code");
        flag = false;
    }

    legal_desc = $("#edit_legal_desc").val()
    var len = legal_desc.length;
    var namePattern = /^[A-Za-z0-9_@&.,#&+-\/]+( [A-Za-z0-9_@$.,#&+-\/]+)*$/;
    if (legal_desc != '' & namePattern.test(legal_desc) & len >=1 & len <= 20) {
        $('#edit_legal_desc_error').css("display", "none");
    }
    else {
        $('#edit_legal_desc_error').css("display", "block");
        $('#edit_legal_desc_error').text("Please enter valid description");
        flag = false;
    }

    if (flag != false){
        $.ajax({
            type: "POST",
            url: "/backofficeapp/update-legal-detail/",
            data: $("#edit_legal_details_form").serialize(),
            success: function(response){
                if (response.success == 'true'){
                    $("#edit_legal_details_modal").modal("hide");
                    $("#legal_error_modal").modal("hide");
                    $("#legal_success_modal").modal("show");
                    filter_legal_detail_table();
                }
                else{
                    $("#edit_legal_details_modal").modal("hide");
                    $("#legal_success_modal").modal("hide");
                    $("#legal_error_modal").modal("show");
                    filter_legal_detail_table();
                }
            }
        });
    }


});

    
// Update Legal Status
function update_legal_status(status, legal_id){
    if (status == "False"){
        $("#active_deactive_legal_status_text").html('').text('Do you want Activate Legal Detail ?');
        $("#legal_status").val(status);
        $("#legal_status_id").val(legal_id);
    }
    else{
        $("#active_deactive_legal_status_text").html('').text('Do you want to Inactivate Legal Detail ?');
        $("#legal_status").val(status);
        $("#legal_status_id").val(legal_id);
    }
}

function change_legal_status(){
    var legal_detail_id = $("#legal_status_id").val();

    $.ajax({
        type: "GET",
        url: '/backofficeapp/update-legal-detail-status/',
        data: {'legal_detail_id': legal_detail_id},

        success: function(response){
            filter_legal_detail_table();
        }
    });
}




</script>

</body>
</html>